<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FGO Servant DataTable (Live API)</title>

    <!-- Datatables + JQuery -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <style>
        img.servant-icon {
            width: 50px;
            border-radius: 6px;
        }
    </style>
</head>
<body>

<h2>FGO Servants (Live NA API)</h2>

<table id="servantTable" class="display">
    <thead>
        <tr>
            <th>ID</th>
            <th>Icon</th>
            <th>Name</th>
            <th>Class</th>
            <th>Rarity</th>
            <th>Attribute</th>
            <th>Release Year</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<script>
$(document).ready(function () {

    // Load servant data directly from API
    $.getJSON("https://api.atlasacademy.io/nice/NA/servant", function (data) {

        // Convert API response into DataTable rows
        const rows = data.map(servant => {

            // Icon URL (first image)
            const icon = servant.extraAssets?.faces?.ascension?.[1] || "";

            // Release year extraction
            const year = servant.releaseDate
                ? new Date(servant.releaseDate).getFullYear()
                : "N/A";

            return [
                servant.id,
                icon ? `<img src="${icon}" class="servant-icon">` : "",
                servant.name,
                servant.className,
                servant.rarity,
                servant.attribute,
                year
            ];
        });

        // Initialize DataTable
        $("#servantTable").DataTable({
            data: rows,
            columns: [
                { title: "ID" },
                { title: "Icon" },
                { title: "Name" },
                { title: "Class" },
                { title: "Rarity" },
                { title: "Attribute" },
                { title: "Release Year" }
            ]
        });

    }).fail(function () {
        alert("Failed to fetch servant data from API.");
    });

});
</script>

</body>
</html>
